{
  "title": "LendingPool: Usage as collateral",
  "description": "Test cases for the setUserUseReserveAsCollateral() function.",
  "stories": [
    {
      "description": "User 0 Deposits 1000 FLEXUSD, disables FLEXUSD as collateral",
      "actions": [
        {
          "name": "mint",
          "args": {
            "reserve": "FLEXUSD",
            "amount": "1000",
            "user": "0"
          },
          "expected": "success"
        },
        {
          "name": "approve",
          "args": {
            "reserve": "FLEXUSD",
            "user": "0"
          },
          "expected": "success"
        },
        {
          "name": "deposit",
          "args": {
            "reserve": "FLEXUSD",
            "amount": "1000",
            "user": "0"
          },
          "expected": "success"
        },
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "FLEXUSD",
            "user": "0",
            "useAsCollateral": "false"
          },
          "expected": "success"
        }
      ]
    },
    {
      "description": "User 1 Deposits 2 WBCH, disables WBCH as collateral, borrows 400 FLEXUSD (revert expected)",
      "actions": [
        {
          "name": "mint",
          "args": {
            "reserve": "WBCH",
            "amount": "2",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "approve",
          "args": {
            "reserve": "WBCH",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "deposit",
          "args": {
            "reserve": "WBCH",
            "amount": "2",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "false"
          },
          "expected": "success"
        },
        {
          "name": "borrow",
          "args": {
            "reserve": "FLEXUSD",
            "amount": "400",
            "borrowRateMode": "variable",
            "user": "1"
          },
          "expected": "revert",
          "revertMessage": "The collateral balance is 0"
        }
      ]
    },
    {
      "description": "User 1 enables WBCH as collateral, borrows 400 FLEXUSD",
      "actions": [
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "true"
          },
          "expected": "success"
        },
        {
          "name": "borrow",
          "args": {
            "reserve": "FLEXUSD",
            "amount": "400",
            "borrowRateMode": "variable",
            "user": "1"
          },
          "expected": "success"
        }
      ]
    },
    {
      "description": "User 1 disables WBCH as collateral (revert expected)",
      "actions": [
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "false"
          },
          "expected": "revert",
          "revertMessage": "User deposit is already being used as collateral"
        }
      ]
    },
    {
      "description": "User 1 Deposits 10 UNILINKWBCH, disables WBCH as collateral. Should revert as 10 UNILINKWBCH are not enough to cover the debt (revert expected)",
      "actions": [
        {
          "name": "mint",
          "args": {
            "reserve": "UNILINKWBCH",
            "amount": "10",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "approve",
          "args": {
            "reserve": "UNILINKWBCH",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "deposit",
          "args": {
            "reserve": "UNILINKWBCH",
            "amount": "10",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "false"
          },
          "expected": "revert"
        }
      ]
    },
    {
      "description": "User 1 Deposits 640 more UNILINKWBCH (enough to cover the FLEXUSD debt), disables WBCH as collateral",
      "actions": [
        {
          "name": "mint",
          "args": {
            "reserve": "UNILINKWBCH",
            "amount": "640",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "deposit",
          "args": {
            "reserve": "UNILINKWBCH",
            "amount": "640",
            "user": "1"
          },
          "expected": "success"
        },
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "false"
          },
          "expected": "success"
        }
      ]
    },
    {
      "description": "User 1 disables UNILINKWBCH as collateral (revert expected)",
      "actions": [
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "UNILINKWBCH",
            "user": "1",
            "useAsCollateral": "false"
          },
          "expected": "revert"
        }
      ]
    },
    {
      "description": "User 1 reenables WBCH as collateral",
      "actions": [
        {
          "name": "setUseAsCollateral",
          "args": {
            "reserve": "WBCH",
            "user": "1",
            "useAsCollateral": "true"
          },
          "expected": "success"
        }
      ]
    }
  ]
}
